<!DOCTYPE html>
<html>

<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="initial-scale=1, width=device-width" />
  <link rel="stylesheet" href="Assets/styles/page2.css" />
  <link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600&display=swap" />
  <link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Lexend:wght@400;600&display=swap" />
</head>

<body>
  <div class="page2">
    <div class="sidemenu">
      <div class="sidemenu1"></div>
      <div class="pfpcircle-parent">
        <div class="pfpcircle"></div>
        <div class="username-wrapper">
          <b class="username">First Name</b>
        </div>
      </div>
      <div class="frame-div">
        <div class="frame-parent1">
          <div class="tasks-parent">
            <b class="tasks">Tasks</b>
            <div class="calendarvector-wrapper">
              <img class="calendarvector-icon" loading="lazy" alt="" src="Assets/images/calendarVector.svg" />
            </div>
          </div>
          <div class="todayframe">
            <div class="highlight"></div>
            <div class="today">Today</div>
          </div>
          <div class="upcomingframe">
            <div class="highlight1"></div>
            <div class="upcoming">Upcoming</div>
          </div>
        </div>
        <div class="frame-parent2">
          <div class="classestext-parent">
            <b class="classestext">Classes</b>
            <div class="checklistvector-wrapper">
              <img class="checklistvector-icon" loading="lazy" alt="" src="Assets/images/checklistVector.svg" />
            </div>
          </div>
          <div class="frame-wrapper1">
            <div class="frame-parent3">
              <div class="classcolorchild-wrapper">
                <div class="classcolorchild"></div>
              </div>
              <div class="classname-parent">
                <div class="classname">Max 20 Characters</div>
                <div class="editvector-wrapper">
                  <img class="editvector-icon" loading="lazy" alt="" src="Assets/images/editVector.svg" />
                </div>
              </div>
            </div>
          </div>
        </div>
        <div class="frame-wrapper2">
          <div class="frame-parent4">
            <div class="classcolorchild-container">
              <div class="classcolorchild1"></div>
            </div>
            <div class="classname-group">
              <div class="classname1">Max 20 Characters</div>
              <div class="editvector-container">
                <img class="editvector-icon1" alt="" src="Assets/images/editVector.svg" />
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
    <section class="page2-inner">
      <header class="frame-header">
        <div class="coordinatorgpt-wrapper">
          <b class="coordinatorgpt1">CoordinatorGPT</b>
        </div>
        <div class="frame-parent5">
          <div class="frame-wrapper3">
            <div class="todaytext-parent">
              <b class="todaytext">Today</b>
              <div class="frame-wrapper4">
                <div class="numassignments-parent">
                  <div class="numassignments"></div>
                  <b class="numtasks">20</b>
                </div>
              </div>
              <div class="duetext-wrapper">
                <b class="duetext">Time</b>
              </div>
            </div>
          </div>
          <div class="tasks1" id="tasksList">
            <div class="separator"></div>
            <div class="highlight2"></div>
          </div>
        </div>
      </header>
    </section>
  </div>
  <script>
    async function fetchUser() {
      try {
        const response = await fetch('/api/user');
        const user = await response.json();
        updateUserName(user);
      } catch (error) {
        console.error('Error fetching user:', error);
      }
    }

    function updateUserName(user) {
      const usernameElement = document.querySelector('.username');
      usernameElement.textContent = user.name.split(' ')[0]; // Get the first name
    }

    async function fetchClasses() {
      try {
        const response = await fetch('/api/classes');
        const classes = await response.json();
        updateClassNames(classes);
      } catch (error) {
        console.error('Error fetching classes:', error);
      }
    }

    async function fetchAssignments() {
      try {
        const response = await fetch('/api/assignments');
        const assignments = await response.json();
        updateAssignments(assignments);
      } catch (error) {
        console.error('Error fetching assignments:', error);
      }
    }

    function updateClassNames(classes) {
      const classElements = document.querySelectorAll('.classname, .classname1');
      classElements.forEach((element, index) => {
        if (index < classes.length) {
          element.textContent = classes[index].name.substring(0, 20);
        }
      });
    }

    function updateAssignments(assignments) {
      const tasksList = document.getElementById('tasksList');
      assignments.forEach(assignment => {
        const assignmentElement = document.createElement('div');
        assignmentElement.classList.add('tasks-inner');
        assignmentElement.innerHTML = `
            <div class="frame-parent6">
              <div class="frame-parent7">
                <div class="checklistbox-wrapper">
                  <div class="checklistbox"></div>
                </div>
                <div class="taskname-parent">
                  <h2 class="taskname">${assignment.title}</h2>
                  <div class="frame-parent8">
                    <div class="classcolor-wrapper">
                      <div class="classcolor"></div>
                    </div>
                    <div class="classname2">${assignment.courseName}</div>
                  </div>
                </div>
              </div>
              <div class="duedate-wrapper">
                <div class="duedate">${formatDueDate(assignment.dueDate, assignment.dueTime)}</div>
              </div>
            </div>
          `;
        tasksList.appendChild(assignmentElement);
      });
    }

    function formatDueDate(dueDate, dueTime) {
      if (dueDate && dueTime) {
        return `${dueDate.month}/${dueDate.day}/${dueDate.year} ${dueTime.hours}:${dueTime.minutes}`;
      } else if (dueDate) {
        return `${dueDate.month}/${dueDate.day}/${dueDate.year}`;
      } else {
        return 'No due date';
      }
    }

    document.addEventListener('DOMContentLoaded', () => {
      fetchClasses();
      fetchAssignments();
    });
  </script>
</body>

</html>